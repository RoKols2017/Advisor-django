{% extends "base.html" %}

{% block title %}–°–æ–±—ã—Ç–∏—è –ø–µ—á–∞—Ç–∏{% endblock %}

{% block content %}
<div class="card shadow-sm">
  <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
    <h5 class="mb-0">üñ®Ô∏è –°–æ–±—ã—Ç–∏—è –ø–µ—á–∞—Ç–∏</h5>
    <a href="{% url 'index' %}" class="btn btn-light btn-sm">üîô –ù–∞–∑–∞–¥</a>
  </div>
  <div class="card-body">

    <form method="GET" class="row g-3 mb-4 align-items-end">
      <div class="col-md-4">
        <label for="dept" class="form-label">üìÅ –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</label>
        <select name="dept" id="dept" class="form-select">
          <option value="">–í—Å–µ</option>
          {% for d in departments %}
            <option value="{{ d.code }}" {% if d.code == selected_dept %}selected{% endif %}>
              {{ d.code }} ‚Äî {{ d.name }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">üìÜ –°</label>
        <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">üìÜ –ü–æ</label>
        <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
      </div>
      <div class="col-md-2 d-grid gap-2">
        <button type="submit" class="btn btn-primary">üîç –§–∏–ª—å—Ç—Ä</button>
        <a href="{% url 'print_events' %}" class="btn btn-outline-secondary">–°–±—Ä–æ—Å</a>
      </div>
    </form>

    <p>
      <strong>üßÆ –í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</strong> {{ total_pages }}<br>
      <small class="text-muted">
        –ü–µ—Ä–∏–æ–¥:
        {% if start_date or end_date %}
          {% if start_date %}—Å {{ start_date }}{% endif %}
          {% if start_date and end_date %} –ø–æ {% endif %}
          {% if end_date %}{{ end_date }}{% endif %}
        {% else %}
          –Ω–µ —É–∫–∞–∑–∞–Ω
        {% endif %}
      </small>
    </p>

    {% if events %}
      <div class="table-responsive">
        <table class="table table-bordered table-striped table-sm align-middle">
          <thead class="table-light">
            <tr>
              <th>–î–∞—Ç–∞</th>
              <th>–§–ò–û</th>
              <th>–ü—Ä–∏–Ω—Ç–µ—Ä</th>
              <th>–î–æ–∫—É–º–µ–Ω—Ç</th>
              <th>–°—Ç—Ä–∞–Ω–∏—Ü</th>
            </tr>
          </thead>
          <tbody>
            {% for event in events %}
              <tr>
                <td>{{ event.timestamp|date:"d.m.Y H:i" }}</td>
                <td>{{ event.user.fio }}</td>
                <td>
                  {{ event.printer.model.code }}-{{ event.printer.building.code }}-{{ event.printer.department.code }}-{{ event.printer.room_number }}-{{ event.printer.printer_index }}
                </td>
                <td>{{ event.document_name }}</td>
                <td>{{ event.pages }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-warning">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –ø–µ—á–∞—Ç–∏ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º.</div>
    {% endif %}

  </div>
</div>
{% endblock %}
